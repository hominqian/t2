# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../dietlibc/pkg_patch/pkg_gcc.chroot.patch
# Copyright (C) 2004 - 2005 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This patch file is dual-licensed. It is available under the license the
# patched project is licensed under, as long as it is an OpenSource license
# as defined at http://www.opensource.org/ (e.g. BSD, X11) or under the terms
# of the GNU General Public License as published by the Free Software
# Foundation; either version 2 of the License, or (at your option) any later
# version.
# --- T2-COPYRIGHT-NOTE-END ---
diff -ruN gcc-3.4.4.orig/gcc/Makefile.in gcc-3.4.4-diet-chroot/gcc/Makefile.in
--- gcc-3.4.4.orig/gcc/Makefile.in	2005-02-24 10:26:57.000000000 +0100
+++ gcc-3.4.4-diet-chroot/gcc/Makefile.in	2005-09-15 16:40:34.000000000 +0200
@@ -345,7 +345,7 @@
 PARTITION_H = $(srcdir)/../include/partition.h
 
 # Default native SYSTEM_HEADER_DIR, to be overridden by targets.
-NATIVE_SYSTEM_HEADER_DIR = /usr/include
+NATIVE_SYSTEM_HEADER_DIR = /usr/dietlibc/include
 # Default cross SYSTEM_HEADER_DIR, to be overridden by targets.
 CROSS_SYSTEM_HEADER_DIR = @CROSS_SYSTEM_HEADER_DIR@
 
diff -ruN gcc-3.4.4.orig/gcc/config/linux.h gcc-3.4.4-diet-chroot/gcc/config/linux.h
--- gcc-3.4.4.orig/gcc/config/linux.h	2003-11-29 04:08:10.000000000 +0100
+++ gcc-3.4.4-diet-chroot/gcc/config/linux.h	2005-09-15 20:47:50.000000000 +0200
@@ -39,22 +39,10 @@
    object constructed before entering `main'.  */
    
 #undef	STARTFILE_SPEC
-#ifdef USE_GNULIBC_1
-#define STARTFILE_SPEC \
-  "%{!shared: \
-     %{pg:gcrt1.o%s} %{!pg:%{p:gcrt1.o%s} \
-		       %{!p:%{profile:gcrt1.o%s} \
-			 %{!profile:crt1.o%s}}}} \
-   crti.o%s %{!shared:crtbegin.o%s} %{shared:crtbeginS.o%s}"
-#elif defined HAVE_LD_PIE
 #define STARTFILE_SPEC \
-  "%{!shared: %{pg|p|profile:gcrt1.o%s;pie:Scrt1.o%s;:crt1.o%s}} \
-   crti.o%s %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
-#else
-#define STARTFILE_SPEC \
-  "%{!shared: %{pg|p|profile:gcrt1.o%s;:crt1.o%s}} \
-   crti.o%s %{static:crtbeginT.o%s;shared|pie:crtbeginS.o%s;:crtbegin.o%s}"
-#endif
+  "start.o%s"
+/*  "%{!shared:start.o%s}\
+   %{shared:shared_not_yet_set_in_STARTFILE_SPEC.o%s}"*/
 
 /* Provide a ENDFILE_SPEC appropriate for GNU/Linux.  Here we tack on
    the GNU/Linux magical crtend.o file (see crtstuff.c) which
@@ -64,7 +52,8 @@
 
 #undef	ENDFILE_SPEC
 #define ENDFILE_SPEC \
-  "%{shared|pie:crtendS.o%s;:crtend.o%s} crtn.o%s"
+  ""
+/*  "%{shared|pie:crtendS.o%s;:crtend.o%s} crtn.o%s" */
 
 /* This is for -profile to use -lc_p instead of -lc.  */
 #ifndef CC1_SPEC
diff -ruN gcc-3.4.4.orig/gcc/cppdefault.c gcc-3.4.4-diet-chroot/gcc/cppdefault.c
--- gcc-3.4.4.orig/gcc/cppdefault.c	2003-03-01 15:31:12.000000000 +0100
+++ gcc-3.4.4-diet-chroot/gcc/cppdefault.c	2005-09-15 20:15:58.000000000 +0200
@@ -26,7 +26,7 @@
 #include "cppdefault.h"
 
 #ifndef STANDARD_INCLUDE_DIR
-#define STANDARD_INCLUDE_DIR "/usr/include"
+#define STANDARD_INCLUDE_DIR "/usr/dietlibc/include"
 #endif
 
 #ifndef STANDARD_INCLUDE_COMPONENT
diff -ruN gcc-3.4.4.orig/gcc/gcc.c gcc-3.4.4-diet-chroot/gcc/gcc.c
--- gcc-3.4.4.orig/gcc/gcc.c	2005-05-01 12:33:14.000000000 +0200
+++ gcc-3.4.4-diet-chroot/gcc/gcc.c	2005-09-15 20:20:10.000000000 +0200
@@ -1411,6 +1411,7 @@
 static const char *const standard_startfile_prefix = STANDARD_STARTFILE_PREFIX;
 static const char *const standard_startfile_prefix_1 = "/lib/";
 static const char *const standard_startfile_prefix_2 = "/usr/lib/";
+static const char *const standard_startfile_prefix_3 = "/usr/lib/";
 
 static const char *const tooldir_base_prefix = TOOLDIR_BASE_PREFIX;
 static const char *tooldir_prefix;
@@ -6158,6 +6159,8 @@
 			    "BINUTILS", PREFIX_PRIORITY_LAST, 0, NULL, 1);
       add_sysrooted_prefix (&startfile_prefixes, standard_startfile_prefix_2,
 			    "BINUTILS", PREFIX_PRIORITY_LAST, 0, NULL, 1);
+      add_sysrooted_prefix (&startfile_prefixes, standard_startfile_prefix_3,
+                            "BINUTILS", PREFIX_PRIORITY_LAST, 0, NULL, 1);
 #if 0 /* Can cause surprises, and one can use -B./ instead.  */
       add_prefix (&startfile_prefixes, "./", NULL,
 		  PREFIX_PRIORITY_LAST, 1, NULL, 0);
